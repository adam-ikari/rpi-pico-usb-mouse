# é¡¹ç›®ä¸Šä¸‹æ–‡æ–‡æ¡£ (IFLOW.md)

## é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: Raspberry Pi Pico USB é¼ æ ‡ç§»åŠ¨æ¨¡æ‹Ÿå™¨

**é¡¹ç›®ç±»åž‹**: åµŒå…¥å¼ç¡¬ä»¶é¡¹ç›® (CircuitPython)

**ä¸»è¦æŠ€æœ¯æ ˆ**:
- CircuitPython 10.0.3
- Raspberry Pi Pico (RP2040)
- USB HID åè®®
- WS2812B LED (NeoPixel)

**é¡¹ç›®ç›®æ ‡**: 
åŸºäºŽ Raspberry Pi Pico å¼€å‘çš„è‡ªç„¶é¼ æ ‡ç§»åŠ¨æ¨¡æ‹Ÿå™¨ï¼Œæ—¨åœ¨æ¨¡æ‹ŸçœŸå®žäººç±»çš„é¼ æ ‡æ“ä½œè¡Œä¸ºï¼Œäº§ç”Ÿæ›´åŠ è‡ªç„¶ã€çœŸå®žçš„é¼ æ ‡ç§»åŠ¨è½¨è¿¹ã€‚è¯¥é¡¹ç›®é€šè¿‡ç¼–ç¨‹å®žçŽ°äººç±»è¿åŠ¨å­¦åŽŸç†ï¼ŒåŒ…å«éžçº¿æ€§ç§»åŠ¨è½¨è¿¹ã€éšæœºå¾®è°ƒå’Œåœé¡¿ã€ä¸è§„åˆ™çš„ç§»åŠ¨é€Ÿåº¦å˜åŒ–ç­‰ç‰¹æ€§ã€‚

## é¡¹ç›®æž¶æž„

### æ ¸å¿ƒæ–‡ä»¶ç»“æž„

```
/home/zhaodi-chen/project/rpi-pico-usb-mouse/
â”œâ”€â”€ boot.py              # CircuitPython å¯åŠ¨é…ç½®ï¼ˆç¦ç”¨ CDC/MIDI/å­˜å‚¨ï¼Œä»…å¯ç”¨ HID é¼ æ ‡ï¼‰
â”œâ”€â”€ code.py              # ä¸»ç¨‹åºå…¥å£ï¼ˆé¼ æ ‡ç§»åŠ¨é€»è¾‘å®žçŽ°ï¼‰
â”œâ”€â”€ constants.py         # å…¨å±€å¸¸é‡å®šä¹‰ï¼ˆæ‰€æœ‰æ¨¡å¼å‚æ•°ã€é¢œè‰²ã€æ—¶é—´é…ç½®ï¼‰
â”œâ”€â”€ pin_config.py        # ç¡¬ä»¶å¼•è„šé…ç½®ï¼ˆLED è¿žæŽ¥åˆ° GP16ï¼‰
â”œâ”€â”€ README.md            # é¡¹ç›®è¯´æ˜Žæ–‡æ¡£
â”œâ”€â”€ LICENSE              # MIT å¼€æºè®¸å¯è¯
â”œâ”€â”€ doc/                 # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ DISCLAIMER.md    # ä½¿ç”¨æ¡æ¬¾ä¸Žå…è´£å£°æ˜Ž
â”‚   â””â”€â”€ circuitpython_fw_download.png
â”œâ”€â”€ fw/                  # å›ºä»¶ç›®å½•
â”‚   â”œâ”€â”€ adafruit-circuitpython-raspberry_pi_pico-en_US-10.0.3.uf2
â”‚   â””â”€â”€ flash_nuke.uf2   # å›ºä»¶æ¸…ç†å·¥å…·
â””â”€â”€ lib/                 # CircuitPython åº“
    â”œâ”€â”€ neopixel.mpy     # WS2812B LED é©±åŠ¨
    â””â”€â”€ adafruit_hid/    # USB HID è®¾å¤‡åº“
        â”œâ”€â”€ __init__.mpy
        â”œâ”€â”€ mouse.mpy    # é¼ æ ‡ HID å®žçŽ°
        â”œâ”€â”€ keyboard.mpy
        â”œâ”€â”€ keycode.mpy
        â””â”€â”€ ...
```

### ä»£ç æž¶æž„è®¾è®¡

#### 1. **boot.py** - ç³»ç»Ÿå¯åŠ¨é…ç½®
- ç¦ç”¨ USB CDCï¼ˆä¸²å£ï¼‰ä»¥é¿å…è¢«ç›‘æŽ§è½¯ä»¶è¯†åˆ«
- ç¦ç”¨ USB MIDI
- ç¦ç”¨ USB å­˜å‚¨æ¨¡å¼ï¼ˆé˜²æ­¢ä»£ç è¢«éšæ„ä¿®æ”¹ï¼‰
- ä»…å¯ç”¨ USB HID é¼ æ ‡è®¾å¤‡

#### 2. **constants.py** - å¸¸é‡ç®¡ç†
é›†ä¸­ç®¡ç†æ‰€æœ‰é…ç½®å‚æ•°ï¼ŒåŒ…æ‹¬ï¼š
- LED ç›¸å…³å¸¸é‡ï¼ˆäº®åº¦ã€é¢œè‰²å®šä¹‰ï¼‰
- é¼ æ ‡ç§»åŠ¨åŸºç¡€å‚æ•°ï¼ˆæ­¥é•¿ã€é€Ÿåº¦æ›²çº¿ï¼‰
- å…­ç§ç§»åŠ¨æ¨¡å¼çš„è¯¦ç»†å‚æ•°
- æ—¶é—´æŽ§åˆ¶å‚æ•°ï¼ˆæ¨¡å¼æŒç»­æ—¶é—´ã€ç­‰å¾…æ—¶é—´ï¼‰

#### 3. **code.py** - æ ¸å¿ƒé€»è¾‘
ä¸»è¦ç»„ä»¶ï¼š
- **MouseMover ç±»**: éžé˜»å¡žå¼é¼ æ ‡ç§»åŠ¨æŽ§åˆ¶å™¨
  - `quick_move_to_target()`: å¿«é€Ÿç§»åŠ¨ï¼ˆåŠ é€Ÿ-åŒ€é€Ÿ-å‡é€Ÿï¼‰
  - `smooth_move_small()`: å°èŒƒå›´å¹³æ»‘ç§»åŠ¨
  - `_create_velocity_profile()`: ç”Ÿæˆé€Ÿåº¦å˜åŒ–æ›²çº¿
  - `update()`: éžé˜»å¡žæ›´æ–°ç§»åŠ¨çŠ¶æ€

- **MouseContext ç±»**: ä¸Šä¸‹æ–‡ç®¡ç†å™¨
  - ç®¡ç†å½“å‰æ¨¡å¼çŠ¶æ€
  - æŽ§åˆ¶ LED å‘¼å¸ç¯æ•ˆæžœ
  - åŠ¨æ€è°ƒæ•´ç§»åŠ¨é¢‘çŽ‡

- **å…­ç§ç§»åŠ¨æ¨¡å¼**:
  1. ç½‘é¡µæµè§ˆæ¨¡å¼ (ðŸŸ¢ ç»¿è‰²)
  2. é¡µé¢æ‰«ææ¨¡å¼ (ðŸ”µ è“è‰²)
  3. æŽ¢ç´¢æ€§ç§»åŠ¨æ¨¡å¼ (ðŸŸ¡ é’è‰²)
  4. éšæœºç§»åŠ¨æ¨¡å¼ (ðŸŸ£ ç´«è‰²)
  5. åœ†å½¢ç§»åŠ¨æ¨¡å¼ (ðŸŸ  æ©™è‰²)
  6. ç›®æ ‡èšç„¦æ¨¡å¼ (ðŸ”´ çº¢è‰²)

#### 4. **pin_config.py** - ç¡¬ä»¶é…ç½®
- LED_PIN = GP16ï¼ˆWS2812B LED è¿žæŽ¥å¼•è„šï¼‰

## ç¡¬ä»¶è¦æ±‚

### å¿…éœ€ç¡¬ä»¶
- **Raspberry Pi Pico** (RP2040 èŠ¯ç‰‡)
- **USB æ•°æ®çº¿** (ç”¨äºŽè¿žæŽ¥ç›®æ ‡è®¡ç®—æœº)

### å¯é€‰ç¡¬ä»¶
- **WS2812B å½©è‰² LED** (è¿žæŽ¥è‡³ GP16 å¼•è„š)
  - GND â†’ GND
  - VCC â†’ 3.3V
  - DIN â†’ GP16

## åŠŸèƒ½ç‰¹æ€§

### 1. è‡ªç„¶ç§»åŠ¨ç®—æ³•
- **åŠ é€Ÿ-åŒ€é€Ÿ-å‡é€Ÿæ›²çº¿**: æ¨¡æ‹Ÿäººç±»æ‰‹éƒ¨ç§»åŠ¨çš„ç‰©ç†ç‰¹æ€§
- **é€Ÿåº¦å˜åŒ–æ›²çº¿**: ä½¿ç”¨å¹³æ–¹å‡½æ•°å®žçŽ°å¹³ç¼“çš„åŠ é€Ÿ/å‡é€Ÿ
- **éšæœºå¾®è°ƒ**: æ¨¡æ‹Ÿæ‰‹éƒ¨å¾®å°æŠ–åŠ¨ï¼ˆÂ±0.5 åˆ° Â±1 åƒç´ ï¼‰
- **æ€è€ƒæš‚åœ**: 15% æ¦‚çŽ‡éšæœºåœé¡¿ï¼Œæ¨¡æ‹Ÿäººç±»æ€è€ƒ

### 2. å…­ç§ç§»åŠ¨æ¨¡å¼
æ¯ç§æ¨¡å¼éƒ½æœ‰ç‹¬ç‰¹çš„ LED é¢œè‰²æŒ‡ç¤ºå’Œè¡Œä¸ºç‰¹å¾ï¼š

| æ¨¡å¼ | é¢œè‰² | è¡Œä¸ºæè¿° | æŒç»­æ—¶é—´ |
|------|------|----------|----------|
| ç½‘é¡µæµè§ˆ | ðŸŸ¢ ç»¿è‰² | å°èŒƒå›´å±€éƒ¨ç§»åŠ¨ï¼Œæ¨¡æ‹Ÿé˜…è¯»ç½‘é¡µ | 3-8ç§’ |
| é¡µé¢æ‰«æ | ðŸ”µ è“è‰² | ä»Žå·¦åˆ°å³æ‰«æï¼Œæ¨¡æ‹Ÿé˜…è¯»æ–‡å­— | 2-4ç§’ |
| æŽ¢ç´¢ç§»åŠ¨ | ðŸŸ¡ é’è‰² | éšæœºæŽ¢ç´¢é¡µé¢ï¼ŒåŒ…å«å°å¹…è·³è½¬ | 3-7ç§’ |
| éšæœºç§»åŠ¨ | ðŸŸ£ ç´«è‰² | éšæ„ç§»åŠ¨ï¼Œå¢žåŠ æ´»åŠ¨è‡ªç„¶æ€§ | 2-5ç§’ |
| åœ†å½¢ç§»åŠ¨ | ðŸŸ  æ©™è‰² | æ²¿åœ†å½¢è½¨è¿¹ç§»åŠ¨ï¼Œæ¨¡æ‹Ÿæ‰‹éƒ¨å¾®éœ‡ | 3-6ç§’ |
| ç›®æ ‡èšç„¦ | ðŸ”´ çº¢è‰² | ä¸“æ³¨ç‰¹å®šåŒºåŸŸï¼Œå¾®è°ƒå’Œå°èŒƒå›´ç§»åŠ¨ | 4-10ç§’ |

### 3. LED çŠ¶æ€åé¦ˆ
- **å‘¼å¸ç¯æ•ˆæžœ**: äº®åº¦åœ¨ 0.1-1.0 ä¹‹é—´å¹³æ»‘å˜åŒ–
- **æ¨¡å¼æŒ‡ç¤º**: ä¸åŒé¢œè‰²å¯¹åº”ä¸åŒç§»åŠ¨æ¨¡å¼
- **æ´»åŠ¨çŠ¶æ€**: ä½Žäº®åº¦è¡¨ç¤ºç­‰å¾…ï¼Œé«˜äº®åº¦è¡¨ç¤ºæ´»åŠ¨

### 4. å®‰å…¨ä¿æŠ¤æœºåˆ¶
- ç¦ç”¨å®‰å…¨æ¨¡å¼å’Œ U ç›˜æ¨¡å¼
- å®Œå…¨ç¦ç”¨ä¸²å£åŠŸèƒ½
- é˜²æ­¢è¢«ç›‘æŽ§è½¯ä»¶è¯†åˆ«
- é˜²æ­¢ä»£ç è¢«éšæ„ä¿®æ”¹

## çƒ§å½•ä¸Žéƒ¨ç½²

### é¦–æ¬¡çƒ§å½•æ­¥éª¤

1. **è¿›å…¥ä¸‹è½½æ¨¡å¼**
   ```
   æŒ‰ä½ Pico ä¸Šçš„ BOOTSEL æŒ‰é’® â†’ æ’å…¥ USB â†’ é‡Šæ”¾æŒ‰é’®
   è®¾å¤‡æ˜¾ç¤ºä¸º RPI-RP2 é©±åŠ¨å™¨
   ```

2. **çƒ§å½• CircuitPython å›ºä»¶**
   ```
   å°† fw/adafruit-circuitpython-raspberry_pi_pico-en_US-10.0.3.uf2 
   æ‹–æ‹½åˆ° RPI-RP2 é©±åŠ¨å™¨
   ç­‰å¾…è®¾å¤‡é‡å¯
   ```

3. **å¤åˆ¶é¡¹ç›®æ–‡ä»¶**
   ```
   å°†ä»¥ä¸‹æ–‡ä»¶/æ–‡ä»¶å¤¹å¤åˆ¶åˆ°é©±åŠ¨å™¨æ ¹ç›®å½•ï¼š
   - lib/ (æ•´ä¸ªæ–‡ä»¶å¤¹)
   - boot.py
   - code.py
   - constants.py
   - pin_config.py
   ```

4. **è‡ªåŠ¨è¿è¡Œ**
   ```
   Pico è‡ªåŠ¨é‡å¯åŽï¼Œç¨‹åºç«‹å³å¼€å§‹è¿è¡Œ
   è®¾å¤‡å°†ä½œä¸º USB HID é¼ æ ‡è¿žæŽ¥åˆ°è®¡ç®—æœº
   ```

### ä¿®æ”¹ä»£ç æµç¨‹

å¦‚éœ€ä¿®æ”¹ä»£ç ï¼Œå¿…é¡»å…ˆæ¸…é™¤å›ºä»¶ï¼š

1. **è¿›å…¥ä¸‹è½½æ¨¡å¼** (æŒ‰ä½ BOOTSEL + æ’å…¥ USB)
2. **çƒ§å½•æ¸…ç†å›ºä»¶**: æ‹–æ‹½ `fw/flash_nuke.uf2` åˆ° RPI-RP2
3. **é‡æ–°çƒ§å½• CircuitPython**: æ‹–æ‹½ CircuitPython å›ºä»¶
4. **å¤åˆ¶æ–°ä»£ç **: å°†ä¿®æ”¹åŽçš„æ–‡ä»¶å¤åˆ¶åˆ°é©±åŠ¨å™¨

## å¼€å‘çº¦å®š

### ä»£ç é£Žæ ¼
- **å‘½åè§„èŒƒ**: 
  - å¸¸é‡ä½¿ç”¨å…¨å¤§å†™ä¸‹åˆ’çº¿å‘½å (CONSTANT_NAME)
  - å‡½æ•°ä½¿ç”¨å°å†™ä¸‹åˆ’çº¿å‘½å (function_name)
  - ç±»ä½¿ç”¨é©¼å³°å‘½å (ClassName)
- **æ³¨é‡Š**: ä½¿ç”¨ä¸­æ–‡æ³¨é‡Šï¼Œæ¸…æ™°è¯´æ˜Žé€»è¾‘
- **æ¨¡å—åŒ–**: å¸¸é‡é›†ä¸­ç®¡ç†ï¼Œé€»è¾‘åˆ†ç¦»

### å‚æ•°è°ƒæ•´
æ‰€æœ‰å¯è°ƒå‚æ•°éƒ½åœ¨ `constants.py` ä¸­å®šä¹‰ï¼ŒåŒ…æ‹¬ï¼š
- ç§»åŠ¨é€Ÿåº¦å’Œè·ç¦»
- æ¨¡å¼æŒç»­æ—¶é—´
- LED é¢œè‰²å’Œäº®åº¦
- æš‚åœå’Œç­‰å¾…æ—¶é—´

### éžé˜»å¡žè®¾è®¡
- ä½¿ç”¨äº‹ä»¶å¾ªçŽ¯è€Œéž `time.sleep()`
- æ¯ 10ms æ›´æ–°ä¸€æ¬¡çŠ¶æ€ (UPDATE_INTERVAL = 0.01)
- æ‰€æœ‰ç§»åŠ¨æ“ä½œéƒ½æ˜¯éžé˜»å¡žçš„

## æŠ€æœ¯ç»†èŠ‚

### é€Ÿåº¦æ›²çº¿ç®—æ³•
```python
# åŠ é€Ÿé˜¶æ®µ: ä½¿ç”¨å¹³æ–¹å‡½æ•°å®žçŽ°å¹³ç¼“åŠ é€Ÿ
factor = START_FACTOR + (END_FACTOR - START_FACTOR) * tÂ²

# åŒ€é€Ÿé˜¶æ®µ: æ·»åŠ  Â±5% çš„éšæœºæ³¢åŠ¨
factor = 1.0 + random.uniform(-0.05, 0.05)

# å‡é€Ÿé˜¶æ®µ: ä½¿ç”¨å¹³æ–¹å‡½æ•°å®žçŽ°å¹³ç¼“å‡é€Ÿ
factor = START_FACTOR - (START_FACTOR - END_FACTOR) * tÂ²
```

### ç§»åŠ¨æ­¥æ•°è®¡ç®—
```python
# åŸºäºŽè·ç¦»è®¡ç®—æ­¥æ•°
base_steps = max(int(distance / BASE_STEP_DISTANCE), MIN_BASE_STEPS)
total_steps = int(base_steps * random.uniform(0.95, 1.05))
```

### LED å‘¼å¸æ•ˆæžœ
```python
# äº®åº¦åœ¨ 0.1-1.0 ä¹‹é—´å¹³æ»‘å˜åŒ–
brightness += direction * (time_delta / 0.005)
if brightness >= 1.0 or brightness <= 0.1:
    direction = -direction  # åè½¬æ–¹å‘
```

## æ³•å¾‹ä¸Žåˆè§„

### âš ï¸ é‡è¦æé†’
- æœ¬é¡¹ç›®ä»…ä¾›**æ•™è‚²ã€ç ”ç©¶å’Œåˆæ³•æµ‹è¯•**ç›®çš„ä½¿ç”¨
- ç¦æ­¢ç”¨äºŽä»»ä½•éžæ³•æ´»åŠ¨æˆ–è¿åå…¬å¸æ”¿ç­–çš„è¡Œä¸º
- åœ¨ä¼ä¸šçŽ¯å¢ƒä½¿ç”¨å‰ï¼Œè¯·èŽ·å¾— IT éƒ¨é—¨æ‰¹å‡†
- è¯¦ç»†æ¡æ¬¾è¯·å‚è§ `doc/DISCLAIMER.md`

### å¼€æºè®¸å¯
- æœ¬é¡¹ç›®é‡‡ç”¨ **MIT License**
- è¯¦æƒ…è¯·å‚è§ `LICENSE` æ–‡ä»¶

## æ•…éšœæŽ’æŸ¥

### è®¾å¤‡æ— æ³•è¯†åˆ«
- ç¡®è®¤å·²çƒ§å½• CircuitPython å›ºä»¶
- æ£€æŸ¥ USB çº¿æ˜¯å¦æ”¯æŒæ•°æ®ä¼ è¾“
- å°è¯•é‡æ–°çƒ§å½•å›ºä»¶

### LED ä¸äº®
- æ£€æŸ¥ LED è¿žæŽ¥æ˜¯å¦æ­£ç¡® (GP16, GND, 3.3V)
- ç¡®è®¤ä½¿ç”¨çš„æ˜¯ WS2812B åž‹å·
- æ£€æŸ¥ `pin_config.py` ä¸­çš„å¼•è„šé…ç½®

### é¼ æ ‡ç§»åŠ¨å¼‚å¸¸
- æ£€æŸ¥ `constants.py` ä¸­çš„å‚æ•°é…ç½®
- ç¡®è®¤ç›®æ ‡ç³»ç»Ÿæ”¯æŒ USB HID é¼ æ ‡
- æŸ¥çœ‹æ˜¯å¦è¢«å®‰å…¨è½¯ä»¶æ‹¦æˆª

### æ— æ³•ä¿®æ”¹ä»£ç 
- é¡¹ç›®å·²ç¦ç”¨ USB å­˜å‚¨æ¨¡å¼
- å¿…é¡»ä½¿ç”¨ `flash_nuke.uf2` æ¸…é™¤å›ºä»¶åŽé‡æ–°çƒ§å½•

## é¡¹ç›®é“¾æŽ¥

- **GitHub ä»“åº“**: https://github.com/adam-ikari/rpi-pico-usb-mouse
- **é—®é¢˜åé¦ˆ**: ä½¿ç”¨ GitHub Issues
- **CircuitPython å®˜ç½‘**: https://circuitpython.org/

## æ›´æ–°æ—¥å¿—

- **2024-12-04**: åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
  - å®žçŽ°å…­ç§ç§»åŠ¨æ¨¡å¼
  - æ·»åŠ  LED çŠ¶æ€æŒ‡ç¤º
  - å®Œå–„å®‰å…¨ä¿æŠ¤æœºåˆ¶
  - ä¼˜åŒ–ç§»åŠ¨ç®—æ³•ï¼Œä½¿ç”¨åŠ é€Ÿ-å‡é€Ÿæ›²çº¿

---

**æœ€åŽæ›´æ–°**: 2025-12-12
**ç»´æŠ¤è€…**: adam-ikari
**CircuitPython ç‰ˆæœ¬**: 10.0.3
