# 鼠标移动模拟器 (Raspberry Pi Pico)

基于 Raspberry Pi Pico 的自然鼠标移动模拟器，旨在模拟真实人类的鼠标操作行为，产生更加自然、真实的鼠标移动轨迹。

## 目录

- [鼠标移动模拟器 (Raspberry Pi Pico)](#鼠标移动模拟器-raspberry-pi-pico)
  - [目录](#目录)
  - [硬件要求](#硬件要求)
  - [功能特性](#功能特性)
  - [移动模式](#移动模式)
  - [LED 状态指示](#led-状态指示)
  - [硬件连接](#硬件连接)
  - [首次烧录](#首次烧录)
  - [运行与控制](#运行与控制)
  - [安全模式说明](#安全模式说明)
    - [如需修改代码](#如需修改代码)
  - [技术细节](#技术细节)
    - [运动学特性](#运动学特性)
    - [核心算法](#核心算法)
      - [1. 向量 PID 控制器](#1-向量-pid-控制器)
      - [2. 二次贝塞尔曲线](#2-二次贝塞尔曲线)
      - [3. 三角函数查表法（LUT）](#3-三角函数查表法lut)
      - [3. Perlin 噪声](#3-perlin-噪声)
      - [4. 风力/重力算法](#4-风力重力算法)
    - [性能指标](#性能指标)
    - [兼容性](#兼容性)
  - [法律声明与使用条款](#法律声明与使用条款)
    - [⚠️ 重要提醒](#️-重要提醒)
    - [使用限制](#使用限制)
    - [免责声明](#免责声明)
  - [开源许可](#开源许可)
  - [贡献](#贡献)

## 硬件要求

- **Raspberry Pi Pico** (RP2040)
- **可选**: WS2812B 彩色 LED (连接至 GP16 引脚)，用于指示当前工作模式

## 功能特性

- **自然移动**: 所有移动统一使用**二次贝塞尔曲线**，实现平滑自然的轨迹
- **PID 人手模拟**: 基于**向量 PID 控制器**模拟人手特性：
  - 反应延迟（100-400ms）
  - 向量随机抖动
  - 单次过冲限制（避免震荡）
- **多样化行为**: 6 种移动模式，各具特色
- **连续切换**: 30% 概率零等待时间，模式间平滑过渡
- **智能暂停**: 模拟人类思考和观察的停顿行为
- **视觉反馈**: LED 呼吸灯 + 平滑颜色过渡（2s ease-in-out）
- **安全保护**: 禁用安全模式和 U 盘模式，防止被随意修改
- **高性能算法**:
  - 统一的二次贝塞尔曲线，256 定点数，精度提升 2.5 倍
  - 三角函数查找表，360° 采样，类级别共享
  - Perlin 噪声模拟手部自然抖动
  - 风力/重力算法增强移动真实度
- **性能优化**:
  - LED 更新限制 30Hz，节省 12% CPU
  - 主动 GC 管理，每 50 次循环
  - 三角函数缓存，PID 噪声复用
- **回报率匹配**: 125Hz 更新频率，匹配 USB HID 默认回报率

## 移动模式

所有模式统一使用**二次贝塞尔曲线 + PID 人手模拟**，确保启停平滑自然。

1. **网页浏览模式** 🌐

   - 模拟网页浏览行为，小范围局部移动和停留观察
   - 特点：中等范围 150-500px，多次小幅调整 3-8 次
   - 持续时间：30-120 秒
   - 算法：贝塞尔曲线 + Perlin 噪声频率 2.0 + PID 修正

2. **页面扫描模式** 📄

   - 模拟从左到右的页面扫描行为，来回扫描 3-8 次
   - 特点：**左右速度不对称**，向右 80% 慢速、向左 140% 快速
   - 持续时间：20-60 秒
   - 算法：贝塞尔曲线 + 风力算法强度 3.0 + 速度调制

3. **探索性移动模式** 🔍

   - 模拟页面大范围探索行为，2-4 次大幅跳转
   - 特点：大范围 ±150px，移动间隔 1.5 秒
   - 持续时间：10-30 秒
   - 算法：贝塞尔曲线 + 长距离跳跃 + PID 修正

4. **随机移动模式** 🎲

   - 模拟随意移动鼠标的行为，2-5 次随机移动
   - 特点：大范围 ±80px，移动间隔 0.5 秒
   - 持续时间：15-60 秒
   - 算法：贝塞尔曲线 + 随机方向 + PID 修正

5. **圆形移动模式** ⭕

   - 鼠标沿大半径椭圆轨迹移动，模拟手部自然晃动
   - 特点：大半径 50-150px，慢速旋转 10-40°/步
   - 持续时间：15-60 秒
   - 算法：椭圆轨迹比例 0.7-1.3 + Perlin 噪声频率 1.5 + 三角函数 LUT

6. **目标聚焦模式** ⚪
   - 模拟专注于特定区域的行为，小范围微调最多 5 次
   - 特点：小范围 50-200px，频繁微调
   - 持续时间：15-60 秒
   - 算法：重力算法强度 0.15 + Perlin 噪声频率 3.0 + PID 修正

## LED 状态指示

| 颜色    | 模式     | 功能                   |
| ------- | -------- | ---------------------- |
| 🔴 红色 | 网页浏览 | 模拟网页浏览行为       |
| 🟢 绿色 | 页面扫描 | 模拟页面扫描/阅读行为  |
| 🔵 蓝色 | 探索移动 | 模拟页面探索行为       |
| 🟡 黄色 | 随机移动 | 模拟随机鼠标移动       |
| 🟣 紫色 | 圆形移动 | 模拟圆形轨迹移动       |
| ⚪ 青色 | 目标聚焦 | 模拟专注区域的微调移动 |

## 硬件连接

1. 将 Raspberry Pi Pico 通过 USB 连接到目标计算机
2. (可选) 将 WS2812B LED 连接到 GP16 引脚，GND 接地，VCC 接 3.3V

## 首次烧录

首次烧录此项目到 Pi Pico 时，请按以下步骤操作：

1. **进入下载模式**：按住 Pi Pico 上的`BOOT`按钮，然后将设备通过 USB 连接到计算机
2. **等待驱动器出现**：设备会显示为一个名为`RPI-RP2`的驱动器
3. **烧录 CircuitPython 固件**：将`fw`文件夹下的`adafruit-circuitpython-raspberry_pi_pico-en_US-10.0.3`文件拖拽到`RPI-RP2`驱动器中
4. **等待安装完成**：等待驱动器重新出现（表示固件已安装完成）
5. **复制项目文件**：将`lib`文件夹、`code.py`和`boot.py`复制到驱动器的根目录中
6. **完成设置**：Pi Pico 将自动重启并开始运行鼠标模拟程序

## 运行与控制

设备将自动以 USB HID 鼠标身份连接到计算机，并立即开始模拟鼠标移动行为。

## 安全模式说明

此项目已禁用 CircuitPython 的安全模式和 U 盘模式，以防止鼠标模拟被意外停止或代码被随意修改。同时，为防止被监控软件识别，已完全禁用串口功能，设备将不会显示为串口设备。

### 如需修改代码

如果需要修改代码，请按以下步骤操作：

1. **进入下载模式**：按住 Pi Pico 上的`BOOT`按钮，然后将设备通过 USB 连接到计算机
2. **等待驱动器出现**：设备会显示为一个名为`RPI-RP2`的驱动器
3. **烧录清理文件**：将`fw`文件夹下的`flash_nuke.uf2`文件拖拽到`RPI-RP2`驱动器中
4. **烧录 CircuitPython 固件**：当`RPI-RP2`驱动器再次出现后，将`fw`文件夹下的`adafruit-circuitpython-raspberry_pi_pico-en_US-10.0.3`文件拖拽到`RPI-RP2`驱动器中
5. **等待安装完成**：等待驱动器重新出现（表示固件已安装完成）
6. **重新烧录项目代码**：将`lib`文件夹、`code.py`和`boot.py`复制到驱动器的根目录中
7. **重新启用保护**：如需重新启用安全模式和 U 盘模式禁用功能，请确认`boot.py`中包含相应的禁用代码

## 技术细节

本项目利用了人类运动学原理和高性能算法，通过编程实现：

### 运动学特性

- 非线性移动轨迹（加速/减速曲线）
- 随机微调和停顿
- 不规则的移动速度变化
- 符合人体工程学的移动模式

### 核心算法

#### 1. 向量 PID 控制器

- **模拟人手特性**：
  - 反应延迟：100-400ms 随机延迟
  - 向量控制：朝向目标的自然运动
  - 单次过冲：允许一次自然过冲，之后降低 90% 修正力度
  - 向量噪声：随机方向和幅度（3 像素，500ms 更新）
- **PID 参数**：Kp=0.8, Ki=0.05, Kd=0.2
- **积分饱和**：±1000 限制，防止失控

#### 2. 二次贝塞尔曲线

- 公式：`B(t) = (1-t)²*P₀ + 2(1-t)t*P₁ + t²*P₂`
- 使用 256 定点数（位移运算），精度提升 2.5 倍
- 统一应用于所有移动，确保启停平滑

#### 3. 三角函数查表法（LUT）

- 预计算 360° sin 值（int × 10000）
- 类级别共享（所有实例复用同一张表）
- PID 噪声缓存（500ms 更新一次，避免重复计算）
- 性能提升：100 倍（vs `math.sin/cos`）
- 内存占用：1.4KB（361 个整数）

#### 3. Perlin 噪声

- 基于 sin 函数的简化噪声生成
- 模拟手部自然抖动
- 频率可调：1.5-3.0

#### 4. 风力/重力算法

- 风力：横向偏移模拟眼球跳动（强度 3.0）
  - 页面扫描应用：向右 80% 慢速，向左 140% 快速（模拟阅读回行）
- 重力：目标点吸引效果（强度 0.15）

### 性能指标

基于长时间测试，3 小时运行 944,300 循环：

| 指标               | 数值                |
| ------------------ | ------------------- |
| 平均 FPS           | 110-120             |
| 平均帧时间         | 8-12ms              |
| 1% Low 帧时间      | <15ms               |
| 内存占用           | 13KB 峰值 / 264KB   |
| 内存可用           | >90KB               |
| 贝塞尔精度         | 256 定点数 0.4%误差 |
| 三角函数加速       | 100x 查找表         |
| LED 更新频率       | 30Hz 节省 12% CPU   |
| PID 反应延迟       | 100-400ms           |
| 支持的移动模式     | 6 种                |
| 模式切换           | 支持零等待连续切换  |
| CircuitPython 版本 | 10.0.3              |
| 目标硬件           | RP2040              |

### 兼容性

- ✅ 仅使用标准库（math、time、random）
- ✅ 无外部依赖
- ✅ 内存占用优化（适合 264KB RAM）
- ✅ CPU 占用优化（适合 133MHz ARM Cortex-M0+）

## 法律声明与使用条款

### ⚠️ 重要提醒

**在使用本项目前，请务必阅读 [使用条款与免责声明](DISCLAIMER.md)。**

### 使用限制

- 本项目仅供教育、研究和合法测试目的使用
- 禁止用于任何非法活动或违反公司政策的行为
- 用户必须确保使用符合当地法律法规
- 在企业环境中使用前，请获得使用许可

### 免责声明

本软件按"原样"提供，不提供任何明示或暗示的保证。使用本软件的风险由用户自行承担。开发者不对因使用本软件而造成的任何损害承担责任。

详细条款请参见 [DISCLAIMER.md](doc/DISCLAIMER.md) 文件。

## 开源许可

本项目采用 MIT 许可证，详情请参见 [LICENSE](LICENSE) 文件。

## 贡献

欢迎提出改进建议和提交 Pull Request。提交贡献即表示您同意本项目的使用条款和免责声明。
