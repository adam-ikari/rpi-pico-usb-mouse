# USB HID é¼ æ ‡å›æŠ¥ç‡é…ç½®æŒ‡å—

## ğŸ“Š å›æŠ¥ç‡è¯´æ˜

**å›æŠ¥ç‡ï¼ˆPolling Rateï¼‰**ï¼šUSB è®¾å¤‡å‘ä¸»æœºæŠ¥å‘Šæ•°æ®çš„é¢‘ç‡

| å›æŠ¥ç‡ | é—´éš” | UPDATE_INTERVAL | é€‚ç”¨åœºæ™¯ |
|--------|------|-----------------|----------|
| **125Hz** | 8ms | 0.008 | CircuitPython é»˜è®¤ï¼Œä½åŠŸè€— |
| **100Hz** | 10ms | 0.010 | **å½“å‰é…ç½®**ï¼Œç¨³å®šå¯é  |
| **250Hz** | 4ms | 0.004 | å¹³è¡¡æ€§èƒ½ä¸åŠŸè€— |
| **500Hz** | 2ms | 0.002 | é«˜æ€§èƒ½é¼ æ ‡æ ‡å‡† |
| **1000Hz** | 1ms | 0.001 | æ¸¸æˆé¼ æ ‡ï¼Œæœ€é«˜æ€§èƒ½ |

---

## ğŸ¯ å½“å‰é…ç½®

### é»˜è®¤é…ç½®ï¼ˆæ¨èï¼‰
- **å›æŠ¥ç‡**: 100Hz
- **æ›´æ–°é—´éš”**: 10ms
- **CPU è´Ÿè½½**: ~15%
- **é…ç½®æ–‡ä»¶**: `boot.py`

**ä¼˜ç‚¹**ï¼š
- âœ… ç¨³å®šå¯é 
- âœ… ä½ CPU å ç”¨
- âœ… å…¼å®¹æ€§å¥½
- âœ… åŠŸè€—ä½

---

## âš¡ é«˜æ€§èƒ½é…ç½®

### 1000Hz é…ç½®ï¼ˆå®éªŒæ€§ï¼‰
- **å›æŠ¥ç‡**: 1000Hz
- **æ›´æ–°é—´éš”**: 1ms
- **CPU è´Ÿè½½**: ~60-80%
- **é…ç½®æ–‡ä»¶**: `boot_high_performance.py`

**æ­¥éª¤**ï¼š

#### 1. ä¿®æ”¹ boot.py
```bash
# é‡å‘½åé«˜æ€§èƒ½é…ç½®
cp boot_high_performance.py boot.py
```

#### 2. ä¿®æ”¹ constants.py
```python
# å°†æ›´æ–°é—´éš”æ”¹ä¸º 1ms
UPDATE_INTERVAL = 0.001  # 1ms = 1000Hz
```

#### 3. é‡å¯ Pico
```
æŒ‰ä½ BOOTSEL æŒ‰é’®ï¼Œé‡æ–°ä¸Šç”µ
```

**æ³¨æ„äº‹é¡¹**ï¼š
- âš ï¸ CPU è´Ÿè½½ä¼šæ˜¾è‘—å¢åŠ ï¼ˆ15% â†’ 70%ï¼‰
- âš ï¸ å¯èƒ½å¯¼è‡´å…¶ä»–åŠŸèƒ½å»¶è¿Ÿ
- âš ï¸ æŸäº›ä¸»æœºä¸æ”¯æŒ 1000Hz
- âš ï¸ macOS M1/M2 å¯èƒ½é™åˆ¶åœ¨ 500Hz

---

## ğŸ”¬ æ€§èƒ½å¯¹æ¯”

### CPU è´Ÿè½½ä¼°ç®—

| å›æŠ¥ç‡ | ç®—æ³•è®¡ç®— | USB ä¼ è¾“ | LED æ›´æ–° | æ€»è´Ÿè½½ |
|--------|---------|---------|---------|--------|
| **100Hz** | 8% | 2% | 5% | **15%** |
| **250Hz** | 15% | 5% | 5% | **25%** |
| **500Hz** | 25% | 10% | 5% | **40%** |
| **1000Hz** | 45% | 20% | 5% | **70%** |

### å“åº”å»¶è¿Ÿ

| å›æŠ¥ç‡ | å¹³å‡å»¶è¿Ÿ | æœ€å¤§å»¶è¿Ÿ | æ„ŸçŸ¥å·®å¼‚ |
|--------|---------|---------|---------|
| **100Hz** | 5ms | 10ms | ä¸æ˜æ˜¾ |
| **250Hz** | 2ms | 4ms | è½»å¾® |
| **500Hz** | 1ms | 2ms | æ˜æ˜¾ |
| **1000Hz** | 0.5ms | 1ms | éå¸¸æ˜æ˜¾ |

---

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### USB æè¿°ç¬¦é…ç½®

#### é»˜è®¤é…ç½®ï¼ˆ125Hzï¼‰
```python
# CircuitPython é»˜è®¤
usb_hid.enable((usb_hid.Device.MOUSE,))
# è½®è¯¢é—´éš”ï¼š8msï¼ˆç”± USB æè¿°ç¬¦å®šä¹‰ï¼‰
```

#### é«˜æ€§èƒ½é…ç½®ï¼ˆ1000Hzï¼‰
```python
# è‡ªå®šä¹‰ HID è®¾å¤‡
mouse = usb_hid.Device(
    report_descriptor=MOUSE_REPORT_DESCRIPTOR,
    usage_page=0x01,
    usage=0x02,
    report_ids=(0,),
    in_report_lengths=(4,),
    out_report_lengths=(0,),
)

# boot_device=1 è®¾ç½® 1ms è½®è¯¢é—´éš”
usb_hid.enable((mouse,), boot_device=1)
```

### ä»£ç åŒæ­¥

**å…³é”®åŸåˆ™**ï¼š`UPDATE_INTERVAL` å¿…é¡» â‰¤ USB è½®è¯¢é—´éš”

```python
# ç¤ºä¾‹ï¼š1000Hz é…ç½®
UPDATE_INTERVAL = 0.001  # 1ms

# ä¸»å¾ªç¯
while True:
    current_time = time.monotonic()
    if current_time - last_update_time >= UPDATE_INTERVAL:
        # æ›´æ–°é¼ æ ‡çŠ¶æ€
        update_mouse()
        last_update_time = current_time
```

---

## ğŸ“ˆ æµ‹è¯•æ–¹æ³•

### 1. åœ¨çº¿æµ‹è¯•å·¥å…·
è®¿é—®ï¼šhttps://www.testufo.com/mouse

**é¢„æœŸç»“æœ**ï¼š
- 100Hz é…ç½®ï¼šæ˜¾ç¤º 100Hz
- 1000Hz é…ç½®ï¼šæ˜¾ç¤º 1000Hzï¼ˆæˆ– 500Hz on macOS M1/M2ï¼‰

### 2. ä»£ç æµ‹è¯•
```python
import time

# æµ‹è¯•å®é™…æ›´æ–°é¢‘ç‡
count = 0
start = time.monotonic()

while count < 1000:
    # æ¨¡æ‹Ÿé¼ æ ‡æ›´æ–°
    mouse.move(x=1, y=0)
    count += 1

end = time.monotonic()
actual_hz = count / (end - start)
print(f"å®é™…é¢‘ç‡: {actual_hz:.1f} Hz")
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šå›æŠ¥ç‡æœªæå‡
**åŸå› **ï¼šUSB æè¿°ç¬¦æœªæ­£ç¡®é…ç½®  
**è§£å†³**ï¼š
1. ç¡®è®¤ä½¿ç”¨äº† `boot_high_performance.py`
2. æ£€æŸ¥ `boot_device=1` å‚æ•°
3. é‡å¯ Pico

### é—®é¢˜ 2ï¼šé¼ æ ‡å¡é¡¿
**åŸå› **ï¼šCPU è´Ÿè½½è¿‡é«˜  
**è§£å†³**ï¼š
1. é™ä½å›æŠ¥ç‡ï¼ˆ500Hz â†’ 250Hzï¼‰
2. ç®€åŒ–ç®—æ³•ï¼ˆç¦ç”¨ Perlin å™ªå£°ï¼‰
3. å¢åŠ  `UPDATE_INTERVAL`

### é—®é¢˜ 3ï¼šmacOS é™åˆ¶åœ¨ 500Hz
**åŸå› **ï¼šApple Silicon çš„ USB é©±åŠ¨é™åˆ¶  
**è§£å†³**ï¼šè¿™æ˜¯å·²çŸ¥é—®é¢˜ï¼Œæ— æ³•è§£å†³

---

## ğŸ’¡ æ¨èé…ç½®

### ä¸€èˆ¬ä½¿ç”¨ï¼ˆæ¨èï¼‰
```python
# constants.py
UPDATE_INTERVAL = 0.01  # 100Hz

# boot.py
usb_hid.enable((usb_hid.Device.MOUSE,))
```

### é«˜æ€§èƒ½éœ€æ±‚
```python
# constants.py
UPDATE_INTERVAL = 0.002  # 500Hz

# boot.py
# ä½¿ç”¨ boot_high_performance.py
# ä¿®æ”¹ boot_device=2ï¼ˆ500Hzï¼‰
```

### æé™æ€§èƒ½ï¼ˆå®éªŒæ€§ï¼‰
```python
# constants.py
UPDATE_INTERVAL = 0.001  # 1000Hz

# boot.py
# ä½¿ç”¨ boot_high_performance.py
# boot_device=1ï¼ˆ1000Hzï¼‰
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

1. [TinyUSB Issue #1705](https://github.com/hathach/tinyusb/issues/1705) - macOS M1/M2 500Hz é™åˆ¶
2. [CircuitPython USB HID](https://github.com/adafruit/circuitpython/tree/main/shared-module/usb_hid)
3. [USB HID è§„èŒƒ](https://www.usb.org/sites/default/files/hid1_11.pdf)

---

## âœ… æ€»ç»“

| é…ç½® | æ€§èƒ½ | ç¨³å®šæ€§ | åŠŸè€— | æ¨èåº¦ |
|------|------|--------|------|--------|
| **100Hz** | â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ |
| **250Hz** | â­â­â­â­ | â­â­â­â­ | â­â­â­â­ | â­â­â­â­ |
| **500Hz** | â­â­â­â­â­ | â­â­â­ | â­â­â­ | â­â­â­ |
| **1000Hz** | â­â­â­â­â­ | â­â­ | â­â­ | â­â­ |

**å»ºè®®**ï¼šé™¤éæœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œä¿æŒé»˜è®¤ 100Hz é…ç½®å³å¯ã€‚
